<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RataLab</title>
    <link rel="icon" type="image/png" href="20251213_180758.png">
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mqtt/4.3.7/mqtt.min.js"></script>
</head>
<body>
    <!-- Bot√≥n hamburguesa -->
    <button class="hamburger-btn" id="hamburgerBtn">
        <span></span>
        <span></span>
        <span></span>
    </button>

    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h1>RataLab - UTN - FRSF</h1>
                <p class="subtitle">Web App</p>
            </div>

            <nav class="sidebar-nav">
                <div class="tab active" data-tab="info">
                    <span class="tab-text">Foro</span>
                </div>
                <div class="tab" data-tab="connection">
                    <span class="tab-text">Conexi√≥n</span>
                </div>
                <div class="tab" data-tab="control">
                    <span class="tab-text">Control Manual</span>
                </div>
                <div class="tab" data-tab="maze">
                    <span class="tab-text">Trayectoria</span>
                </div>
                <div class="tab" data-tab="console">
                    <span class="tab-text">Consola Serial</span>
                </div>
            </nav>

            <div class="sidebar-footer">
                <div id="status" class="status disconnected">Desconectado</div>
                <div class="logo-container">
                    <img src="20251213_180758.png" alt="RataLab" class="footer-logo">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/8/82/UTN_logo.jpg" alt="UTN" class="footer-logo">
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- FORO TAB (PREDETERMINADA) -->
            <div id="info-tab" class="tab-content active">
                <h2>Foro del Proyecto</h2>
                
                <div class="info-box">
                    <h3>¬øQu√© es RataLab?</h3>
                    <p>RataLab es una plataforma web innovadora desarrollada por estudiantes de la Universidad Tecnol√≥gica Nacional - Facultad Regional Santa Fe (UTN-FRSF) para el control, monitoreo y an√°lisis de robots m√≥viles aut√≥nomos especializados en la resoluci√≥n de laberintos.</p>
                    <p>Este proyecto integra m√∫ltiples disciplinas de la ingenier√≠a electr√≥nica, combinando programaci√≥n de sistemas embebidos, comunicaciones IoT, algoritmos de optimizaci√≥n y desarrollo web para crear una soluci√≥n completa de rob√≥tica educativa.</p>
                    <p>El sistema permite la interacci√≥n en tiempo real con robots basados en ESP32, visualizaci√≥n de trayectorias, control manual mediante interfaz web o teclado, y la aplicaci√≥n de algoritmos avanzados de pathfinding para encontrar rutas √≥ptimas en laberintos complejos.</p>
                </div>

                <div class="info-box">
                    <h3>Tecnolog√≠as Utilizadas</h3>
                    <p><strong>Hardware:</strong> Placa de desarrollo ESP32 con conectividad WiFi integrada, sensores ultras√≥nicos HC-SR04 para detecci√≥n de obst√°culos, sensores infrarrojos para seguimiento de l√≠nea, encoders para odometr√≠a precisa y motores DC con driver L298N.</p>
                    <p><strong>Comunicaci√≥n:</strong> Protocolo MQTT (Message Queuing Telemetry Transport), un protocolo ultraligero de mensajer√≠a publish/subscribe ideal para aplicaciones IoT. Utilizamos HiveMQ Cloud como broker para garantizar comunicaci√≥n confiable y de baja latencia.</p>
                    <p><strong>Software:</strong> Frontend desarrollado con HTML5, CSS3 y JavaScript vanilla para m√°xima compatibilidad. Backend embebido en ESP32 programado con Arduino IDE. Algoritmos de resoluci√≥n de laberintos implementados: A* (heur√≠stico), Dijkstra (√≥ptimo) y BFS (amplitud).</p>
                    <p><strong>Matem√°tica de Optimizaci√≥n:</strong> Implementaci√≥n de grafos para representaci√≥n del laberinto, funciones heur√≠sticas para A*, y algoritmos de b√∫squeda en grafos para encontrar el camino m√°s corto entre dos puntos.</p>
                </div>

                <div class="info-box">
                    <h3>Caracter√≠sticas del Robot</h3>
                    <p>‚Ä¢ <strong>Navegaci√≥n Aut√≥noma:</strong> Capacidad de explorar laberintos sin intervenci√≥n humana utilizando sensores ultras√≥nicos e infrarrojos.</p>
                    <p>‚Ä¢ <strong>Control Remoto:</strong> Operaci√≥n manual desde la interfaz web con controles de teclado (W, A, S, D, X) o botones t√°ctiles.</p>
                    <p>‚Ä¢ <strong>Odometr√≠a Precisa:</strong> Sistema de encoders que registra cada movimiento del robot con precisi√≥n de cent√≠metros.</p>
                    <p>‚Ä¢ <strong>Visualizaci√≥n en Tiempo Real:</strong> Gr√°fico din√°mico de la trayectoria recorrida con escala ajustable.</p>
                    <p>‚Ä¢ <strong>Algoritmos Inteligentes:</strong> Tres algoritmos de resoluci√≥n disponibles para comparar eficiencia y rendimiento.</p>
                </div>

                <div class="info-box download-section">
                    <h3>üì• Descargas</h3>
                    
                    <!-- Manual de Usuario -->
                    <div class="download-category">
                        <div class="category-header">
                            <div class="download-icon">üìÑ</div>
                            <div class="category-info">
                                <h4>Manual de Usuario</h4>
                                <p>Gu√≠a completa de instalaci√≥n, configuraci√≥n y uso del sistema RataLab</p>
                            </div>
                        </div>
                        <a href="https://raw.githubusercontent.com/Eltomyalfonzo/RataLab/main/Manual_RataLab.pdf" download class="download-btn">
                            Descargar Manual (PDF)
                        </a>
                    </div>

                    <!-- Firmwares -->
                    <div class="download-category">
                        <div class="category-header" onclick="toggleFirmwareList()">
                            <div class="download-icon">üíæ</div>
                            <div class="category-info">
                                <h4>Firmwares ESP32 <span class="expand-arrow" id="firmwareArrow">‚ñº</span></h4>
                                <p>C√≥digo fuente para cargar en la placa ESP32 del robot</p>
                            </div>
                        </div>
                        
                        <div class="firmware-list" id="firmwareList" style="display: none;">
                            <div class="firmware-item">
                                <div class="firmware-info">
                                    <strong>Firmware v1.0 - B√°sico</strong>
                                    <span class="firmware-tag">Estable</span>
                                    <p>Control manual y modo autom√°tico con sensores ultras√≥nicos</p>
                                </div>
                                <a href="https://raw.githubusercontent.com/Eltomyalfonzo/RataLab/main/firmware_esp32.ino" download class="download-btn-small">
                                    Descargar
                                </a>
                            </div>
                            
                            <div class="firmware-item">
                                <div class="firmware-info">
                                    <strong>Firmware v1.1 - Encoders</strong>
                                    <span class="firmware-tag firmware-tag-beta">Beta</span>
                                    <p>Incluye soporte para encoders y odometr√≠a avanzada</p>
                                </div>
                                <a href="https://raw.githubusercontent.com/Eltomyalfonzo/RataLab/main/firmware_esp32_v1.1.ino" download class="download-btn-small">
                                    Descargar
                                </a>
                            </div>
                            
                            <div class="firmware-item">
                                <div class="firmware-info">
                                    <strong>Firmware v2.0 - Laberintos</strong>
                                    <span class="firmware-tag firmware-tag-new">Nuevo</span>
                                    <p>Algoritmos de resoluci√≥n de laberintos integrados (A*, Dijkstra, BFS)</p>
                                </div>
                                <a href="https://raw.githubusercontent.com/Eltomyalfonzo/RataLab/main/firmware_esp32_v2.0.ino" download class="download-btn-small">
                                    Descargar
                                </a>
                            </div>
                            
                            <div class="firmware-item">
                                <div class="firmware-info">
                                    <strong>Firmware v2.1 - Completo</strong>
                                    <span class="firmware-tag firmware-tag-recommended">Recomendado</span>
                                    <p>Versi√≥n completa con todas las caracter√≠sticas optimizadas</p>
                                </div>
                                <a href="https://raw.githubusercontent.com/Eltomyalfonzo/RataLab/main/firmware_esp32_v2.1.ino" download class="download-btn-small">
                                    Descargar
                                </a>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="info-box">
                    <h3>üîß Repositorio GitHub</h3>
                    <p>El c√≥digo completo del proyecto est√° disponible como open source en GitHub. Incluye el frontend web, firmware para ESP32, documentaci√≥n t√©cnica y ejemplos de uso.</p>
                    <div class="github-link">
                        <svg width="24" height="24" viewBox="0 0 16 16" fill="currentColor">
                            <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
                        </svg>
                        <a href="https://github.com/Eltomyalfonzo/RataLab" target="_blank" rel="noopener">
                            https://github.com/Eltomyalfonzo/RataLab
                        </a>
                    </div>
                    <p style="margin-top: 12px; font-size: 0.875em; color: #64748b;">‚≠ê Si te gusta el proyecto, no olvides darle una estrella en GitHub</p>
                </div>

                <div class="info-box">
                    <h3>Configuraci√≥n del Broker MQTT</h3>
                    <p><strong>Proveedor:</strong> HiveMQ Cloud (Servicio de broker MQTT en la nube)</p>
                    <p><strong>Host:</strong> f9d90e4c488c4716ac1e5862b9c8a708.s1.eu.hivemq.cloud</p>
                    <p><strong>Puerto:</strong> 8884 (WebSocket Secure - wss://)</p>
                    <p><strong>Protocolo:</strong> MQTT v3.1.1 sobre WebSockets seguros</p>
                </div>

                <div class="info-box">
                    <h3>Estructura de Topics MQTT</h3>
                    <p><strong>[nombre_robot]/cmd</strong> - Topic para enviar comandos al robot (F=adelante, B=atr√°s, L=izquierda, R=derecha, S=detener, V###=velocidad)</p>
                    <p><strong>[nombre_robot]/data</strong> - Topic para recibir datos del robot (coordenadas X,Y, estado de sensores, confirmaciones)</p>
                    <p><strong>Ejemplo:</strong> Para un robot llamado "robot01", los topics ser√≠an "robot01/cmd" y "robot01/data"</p>
                </div>

                <div class="info-box">
                    <h3>Comandos Especiales</h3>
                    <p><strong>CONNECT</strong> - Comando enviado por la web app para iniciar la conexi√≥n con el robot</p>
                    <p><strong>CONNECTED</strong> - Respuesta del robot confirmando que est√° listo para recibir comandos</p>
                    <p><strong>V###</strong> - Comando para ajustar velocidad de los motores (0-255)</p>
                    <p><strong>F, B, L, R, S</strong> - Comandos de movimiento (Forward, Backward, Left, Right, Stop)</p>
                </div>

                <div class="info-box">
                    <h3>Algoritmos de Resoluci√≥n de Laberintos</h3>
                    <p><strong>A* (A-Star):</strong> Algoritmo de b√∫squeda heur√≠stica que utiliza una funci√≥n de costo f(n) = g(n) + h(n), donde g(n) es el costo desde el inicio hasta el nodo actual y h(n) es la heur√≠stica (estimaci√≥n) del costo hasta el objetivo. Es eficiente y encuentra rutas casi √≥ptimas r√°pidamente.</p>
                    <p><strong>Dijkstra:</strong> Algoritmo cl√°sico que garantiza encontrar el camino m√°s corto. Explora todos los nodos en orden de distancia desde el origen. M√°s lento que A* pero asegura la soluci√≥n √≥ptima sin depender de heur√≠sticas.</p>
                    <p><strong>BFS (Breadth-First Search):</strong> B√∫squeda en amplitud que explora el grafo nivel por nivel. Garantiza encontrar el camino con menor n√∫mero de pasos, ideal para laberintos sin pesos en las aristas.</p>
                </div>

                <div class="info-box">
                    <h3>Equipo de Desarrollo</h3>
                    <p><strong>Instituci√≥n:</strong> Universidad Tecnol√≥gica Nacional - Facultad Regional Santa Fe</p>
                    <p><strong>Carrera:</strong> Ingenier√≠a Electr√≥nica</p>
                    <p><strong>Integrantes:</strong> Alfonzo, Olmos y Ceballos</p>
                    <p><strong>Versi√≥n:</strong> Beta 1.0 (Diciembre 2025)</p>
                    <p style="margin-top: 12px; font-style: italic; color: #64748b;">Proyecto desarrollado como parte de la formaci√≥n acad√©mica en sistemas embebidos, rob√≥tica e IoT.</p>
                </div>
            </div>

            <!-- CONNECTION TAB -->
            <div id="connection-tab" class="tab-content">
                <h2>Conectividad</h2>
                <div class="input-group">
                    <input type="text" id="robotName" placeholder="Nombre del Robot (Topic)" value="robot01">
                    <button id="connectBtn">Conectar</button>
                </div>
                <div class="info-box">
                    <h3>Instrucciones:</h3>
                    <p>1. Ingresa el nombre del robot (este ser√° el topic MQTT)</p>
                    <p>2. Aseg√∫rate de que tu ESP32 est√© encendido y conectado</p>
                    <p>3. Haz clic en "Conectar" para establecer la conexi√≥n</p>
                    <p>4. Espera la confirmaci√≥n del robot</p>
                </div>
            </div>

            <!-- CONTROL TAB -->
            <div id="control-tab" class="tab-content">
                <h2>Control Manual del Robot</h2>
                
                <div class="control-status">
                    <div id="controlStatus" class="control-disabled">
                        ‚ö†Ô∏è Conecta el robot primero
                    </div>
                </div>

                <div class="mode-selector">
                    <button id="btnManual" class="mode-btn active">Control Manual</button>
                    <button id="btnAutomatic" class="mode-btn">Modo Autom√°tico</button>
                </div>

                <div id="manualControls" class="control-section">
                    <div class="control-panel">
                        <div class="control-row">
                            <button class="control-btn" id="btnForward" disabled>
                                <span class="arrow">‚ñ≤</span>
                                <span class="label">Adelante</span>
                                <span class="key">W</span>
                            </button>
                        </div>
                        <div class="control-row">
                            <button class="control-btn" id="btnLeft" disabled>
                                <span class="arrow">‚óÑ</span>
                                <span class="label">Izquierda</span>
                                <span class="key">A</span>
                            </button>
                            <button class="control-btn" id="btnStop" disabled>
                                <span class="arrow">‚ñ†</span>
                                <span class="label">Detener</span>
                                <span class="key">S</span>
                            </button>
                            <button class="control-btn" id="btnRight" disabled>
                                <span class="arrow">‚ñ∫</span>
                                <span class="label">Derecha</span>
                                <span class="key">D</span>
                            </button>
                        </div>
                        <div class="control-row">
                            <button class="control-btn" id="btnBackward" disabled>
                                <span class="arrow">‚ñº</span>
                                <span class="label">Atr√°s</span>
                                <span class="key">X</span>
                            </button>
                        </div>
                    </div>

                    <div class="control-settings">
                        <label>
                            Velocidad: 
                            <input type="range" id="speedSlider" min="0" max="255" value="150" disabled>
                            <span id="speedValue">150</span>
                        </label>
                    </div>

                    <div class="info-box">
                        <h3>Controles de teclado:</h3>
                        <p><strong>W</strong> - Avanzar</p>
                        <p><strong>S</strong> - Detener</p>
                        <p><strong>A</strong> - Girar izquierda</p>
                        <p><strong>D</strong> - Girar derecha</p>
                        <p><strong>X</strong> - Retroceder</p>
                        <p class="note">Los controles solo funcionan cuando est√°s conectado al robot</p>
                    </div>
                </div>

                <div id="automaticControls" class="control-section" style="display: none;">
                    <div class="info-box">
                        <h3>Modo Autom√°tico Activado</h3>
                        <p>El robot est√° funcionando de manera aut√≥noma utilizando:</p>
                        <ul>
                            <li><strong>3 Sensores Ultras√≥nicos</strong> - Detecci√≥n de obst√°culos</li>
                            <li><strong>Sensor Infrarrojo</strong> - Seguimiento de l√≠nea (negro/blanco)</li>
                        </ul>
                        <p class="note">El robot se detendr√° autom√°ticamente al detectar l√≠nea blanca</p>
                    </div>
                    
                    <div class="automatic-status">
                        <div class="status-indicator">
                            <div class="indicator-dot"></div>
                            <span>Sistema Aut√≥nomo Activo</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- MAZE TAB -->
            <div id="maze-tab" class="tab-content">
                <h2>Trayectoria del Robot</h2>
                <div class="maze-controls">
                    <input type="file" id="mazeFile" accept=".txt" style="display: none;">
                    <button id="loadMazeBtn" onclick="document.getElementById('mazeFile').click()">
                        Cargar Datos
                    </button>
                    <button id="clearMazeBtn" onclick="Maze.clear(); Console.logSystem('Trayectoria borrada')">
                        Limpiar
                    </button>
                    <button id="exportMazeBtn" onclick="exportMazeData()">
                        Exportar
                    </button>
                </div>
                
                <div class="solver-controls">
                    <div class="solver-group">
                        <label for="algorithmSelect">Algoritmo:</label>
                        <select id="algorithmSelect">
                            <option value="astar">A* (Heur√≠stico)</option>
                            <option value="dijkstra">Dijkstra (√ìptimo)</option>
                            <option value="bfs">BFS (Amplitud)</option>
                        </select>
                        <button id="solveBtn" onclick="solveMaze()">
                            Resolver Laberinto
                        </button>
                        <button id="toggleSolutionBtn" onclick="toggleSolution()" style="display: none;">
                            Ocultar Soluci√≥n
                        </button>
                    </div>
                </div>
                
                <div class="maze-settings">
                    <label>
                        Ancho del trazo (cm): 
                        <input type="number" id="wallWidth" value="2" min="0.5" max="10" step="0.5" 
                               onchange="Maze.setWallWidth(parseFloat(this.value))">
                    </label>
                    <label>
                        Escala (px/cm): 
                        <input type="number" id="scale" value="20" min="5" max="50" step="5"
                               onchange="Maze.setScale(parseFloat(this.value))">
                    </label>
                </div>
                
                <div class="canvas-container">
                    <canvas id="mazeCanvas"></canvas>
                </div>
                
                <div class="info-box">
                    <h3>Formato de datos:</h3>
                    <p>Cada l√≠nea representa una coordenada (X,Y) en cent√≠metros:</p>
                    <pre style="background: #f8f9fa; padding: 10px; border-radius: 4px; color: #1e293b; border: 1px solid #e2e8f0;">0,0
0.5,0
1.2,0.3
2.5,1.8
...</pre>
                    <p><span class="legend-color" style="background: #10b981;"></span> <strong>Verde:</strong> Punto de inicio</p>
                    <p><span class="legend-color" style="background: #ef4444;"></span> <strong>Rojo:</strong> Posici√≥n final</p>
                    <p><span class="legend-color" style="background: #3b82f6;"></span> <strong>Azul:</strong> Trayectoria recorrida</p>
                    <p><span class="legend-color" style="background: #f59e0b;"></span> <strong>Amarillo:</strong> Soluci√≥n del algoritmo</p>
                </div>
            </div>

            <!-- CONSOLE TAB -->
            <div id="console-tab" class="tab-content">
                <h2>Puerto Serial Virtual</h2>
                <div id="console" class="console"></div>
                <div class="input-group" style="margin-top: 15px;">
                    <input type="text" id="messageInput" placeholder="Escribe un mensaje..." disabled>
                    <button id="sendBtn" disabled>Enviar</button>
                </div>
                <button class="clear-btn">Limpiar Consola</button>
            </div>
        </main>
    </div>

    <script src="config.js"></script>
    <script src="console.js"></script>
    <script src="maze.js"></script>
    <script src="solver.js"></script>
    <script src="control.js"></script>
    <script src="ui.js"></script>
    <script src="mqtt.js"></script>
    <script>
        // Men√∫ hamburguesa - debe ejecutarse ANTES de DOMContentLoaded
        window.addEventListener('load', () => {
            const hamburgerBtn = document.getElementById('hamburgerBtn');
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.querySelector('.main-content');
            
            if (hamburgerBtn && sidebar && mainContent) {
                hamburgerBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    sidebar.classList.toggle('sidebar-hidden');
                    mainContent.classList.toggle('sidebar-hidden');
                    hamburgerBtn.classList.toggle('active');
                    console.log('Hamburger clicked, sidebar hidden:', sidebar.classList.contains('sidebar-hidden'));
                });
                
                // Cerrar sidebar al hacer click en una tab (en m√≥viles)
                document.querySelectorAll('.tab').forEach(tab => {
                    tab.addEventListener('click', () => {
                        if (window.innerWidth <= 768) {
                            sidebar.classList.add('sidebar-hidden');
                            mainContent.classList.add('sidebar-hidden');
                            hamburgerBtn.classList.remove('active');
                        }
                    });
                });
            }
        });
        
        document.addEventListener('DOMContentLoaded', () => {
            // Archivo de laberinto
            document.getElementById('mazeFile').addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    Maze.loadFromFile(file);
                }
            });
        });

        function toggleFirmwareList() {
            const list = document.getElementById('firmwareList');
            const arrow = document.getElementById('firmwareArrow');
            
            if (list.style.display === 'none') {
                list.style.display = 'block';
                arrow.textContent = '‚ñ≤';
            } else {
                list.style.display = 'none';
                arrow.textContent = '‚ñº';
            }
        }

        function exportMazeData() {
            const data = Maze.exportData();
            if (!data) {
                Console.logError('No hay datos para exportar');
                return;
            }
            
            const blob = new Blob([data], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `trayectoria_${new Date().getTime()}.txt`;
            a.click();
            URL.revokeObjectURL(url);
            Console.logSystem('Datos exportados exitosamente');
        }

        function solveMaze() {
            const algorithm = document.getElementById('algorithmSelect').value;
            const solution = MazeSolver.solve(algorithm);
            
            if (solution) {
                Maze.setSolution(solution);
                document.getElementById('toggleSolutionBtn').style.display = 'inline-block';
                Console.logSystem(`‚úì Laberinto resuelto con ${algorithm.toUpperCase()}`);
            }
        }

        function toggleSolution() {
            Maze.toggleSolution();
            const btn = document.getElementById('toggleSolutionBtn');
            btn.textContent = Maze.showSolution ? 'Ocultar Soluci√≥n' : 'Mostrar Soluci√≥n';
        }
    </script>
</body>
</html>
