<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RataLab</title>
    <link rel="icon" type="image/png" href="20251213_180758.png">
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mqtt/4.3.7/mqtt.min.js"></script>
</head>
<body>
    <!-- Barra superior con logo y tÃ­tulo -->
    <header class="top-header">
        <button class="hamburger-btn" id="hamburgerBtn">
            <span></span>
            <span></span>
            <span></span>
        </button>
        
        <div class="header-content">
            <img src="20251213_180758.png" alt="RataLab Logo" class="header-logo-large">
            <div class="header-title">
                <h1>RataLab - UTN - FRSF</h1>
                <p class="subtitle">Web App</p>
            </div>
        </div>
    </header>

    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <nav class="sidebar-nav">
                <div class="tab active" data-tab="info">
                    <span class="tab-text">ğŸ“‹ Foro</span>
                </div>
                <div class="tab" data-tab="connection">
                    <span class="tab-text">ğŸ”Œ ConexiÃ³n</span>
                </div>
                <div class="tab" data-tab="control">
                    <span class="tab-text">ğŸ® Control Manual</span>
                </div>
                <div class="tab" data-tab="maze">
                    <span class="tab-text">ğŸ—ºï¸ Trayectoria</span>
                </div>
                <div class="tab" data-tab="console">
                    <span class="tab-text">ğŸ’» Consola Serial</span>
                </div>
            </nav>

            <div class="sidebar-footer">
                <div id="status" class="status disconnected">Desconectado</div>
                <div class="logo-container">
                    <img src="20251213_180758.png" alt="RataLab" class="footer-logo">
                    <img src="logo.svg" alt="UTN" class="footer-logo">
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">

            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• FORO TAB -->
            <div id="info-tab" class="tab-content active">
                <h2>Foro del Proyecto</h2>
                
                <div class="info-box">
                    <h3>Â¿QuÃ© es RataLab?</h3>
                    <p>RataLab es una plataforma web innovadora desarrollada por estudiantes de la Universidad TecnolÃ³gica Nacional - Facultad Regional San Fransisco (UTN-FRSF) para el control, monitoreo y anÃ¡lisis de robots mÃ³viles autÃ³nomos especializados en la resoluciÃ³n de laberintos.</p>
                    <p>Este proyecto integra mÃºltiples disciplinas de la ingenierÃ­a electrÃ³nica, combinando programaciÃ³n de sistemas embebidos, comunicaciones IoT, algoritmos de optimizaciÃ³n y desarrollo web para crear una soluciÃ³n completa de robÃ³tica educativa.</p>
                    <p>El sistema permite la interacciÃ³n en tiempo real con robots basados en ESP32, visualizaciÃ³n de trayectorias, control manual mediante interfaz web o teclado, y la aplicaciÃ³n de algoritmos avanzados de pathfinding para encontrar rutas Ã³ptimas en laberintos complejos.</p>
                </div>

                <div class="info-box">
                    <h3>TecnologÃ­as Utilizadas</h3>
                    <p><strong>Hardware:</strong> Placa de desarrollo ESP32 con conectividad WiFi integrada, sensores ultrasÃ³nicos HC-SR04 para detecciÃ³n de obstÃ¡culos, sensores infrarrojos para seguimiento de lÃ­nea, encoders para odometrÃ­a precisa y motores DC con driver L298N.</p>
                    <p><strong>ComunicaciÃ³n:</strong> Protocolo MQTT (Message Queuing Telemetry Transport), un protocolo ultraligero de mensajerÃ­a publish/subscribe ideal para aplicaciones IoT. Utilizamos HiveMQ Cloud como broker para garantizar comunicaciÃ³n confiable y de baja latencia.</p>
                    <p><strong>Software:</strong> Frontend desarrollado con HTML5, CSS3 y JavaScript vanilla para mÃ¡xima compatibilidad. Backend embebido en ESP32 programado con Arduino IDE. Algoritmos de resoluciÃ³n de laberintos implementados: A* (heurÃ­stico), Dijkstra (Ã³ptimo) y BFS (amplitud).</p>
                    <p><strong>Algoritmo de Mapeo:</strong> ImplementaciÃ³n del algoritmo <strong>Tremouse</strong> con 3 sensores ultrasonido (izquierdo, frontal, derecho) usando la regla de mano izquierda. El robot publica en tiempo real la posiciÃ³n de cada celda y sus paredes detectadas.</p>
                </div>

                <div class="info-box">
                    <h3>CaracterÃ­sticas del Robot</h3>
                    <p>â€¢ <strong>Mapeo Tremouse:</strong> ExploraciÃ³n celda a celda con 3 sensores ultrasonido. El robot detecta paredes a izquierda, frente y derecha y las transmite en tiempo real a la web.</p>
                    <p>â€¢ <strong>Control Remoto:</strong> OperaciÃ³n manual desde la interfaz web con controles de teclado (W, A, S, D, X) o botones tÃ¡ctiles.</p>
                    <p>â€¢ <strong>OdometrÃ­a Precisa:</strong> Sistema de encoders que registra cada movimiento del robot con precisiÃ³n de centÃ­metros.</p>
                    <p>â€¢ <strong>VisualizaciÃ³n en Tiempo Real:</strong> GrÃ¡fico dinÃ¡mico del laberinto con paredes (naranja), trayectoria (azul) y posiciÃ³n del robot.</p>
                    <p>â€¢ <strong>Algoritmos Inteligentes:</strong> Tres algoritmos de resoluciÃ³n disponibles para comparar eficiencia y rendimiento.</p>
                </div>

                <div class="info-box download-section">
                    <h3>Descargas</h3>
                    
                    <div class="download-category">
                        <div class="category-header">
                            <div class="download-icon">ğŸ“„</div>
                            <div class="category-info">
                                <h4>Manual de Usuario</h4>
                                <p>GuÃ­a completa de instalaciÃ³n, configuraciÃ³n y uso del sistema RataLab</p>
                            </div>
                        </div>
                        <a href="https://raw.githubusercontent.com/Eltomyalfonzo/RataLab/main/Manual_RataLab.pdf" download class="download-btn">
                            Descargar Manual (PDF)
                        </a>
                    </div>

                    <div class="download-category">
                        <div class="category-header" onclick="toggleFirmwareList()">
                            <div class="download-icon">ğŸ’¾</div>
                            <div class="category-info">
                                <h4>Firmwares ESP32 <span class="expand-arrow" id="firmwareArrow">â–¼</span></h4>
                                <p>CÃ³digo fuente para cargar en la placa ESP32 del robot</p>
                            </div>
                        </div>
                        
                        <div class="firmware-list" id="firmwareList" style="display: none;">
                            <div class="firmware-item">
                                <div class="firmware-info">
                                    <strong>Firmware v1.0 - BÃ¡sico</strong>
                                    <span class="firmware-tag">Estable</span>
                                    <p>Control manual y modo automÃ¡tico con sensores ultrasÃ³nicos</p>
                                </div>
                                <a href="https://raw.githubusercontent.com/Eltomyalfonzo/RataLab/main/firmware_esp32.ino" download class="download-btn-small">Descargar</a>
                            </div>
                            <div class="firmware-item">
                                <div class="firmware-info">
                                    <strong>Firmware v1.1 - Encoders</strong>
                                    <span class="firmware-tag firmware-tag-beta">Beta</span>
                                    <p>Incluye soporte para encoders y odometrÃ­a avanzada</p>
                                </div>
                                <a href="https://raw.githubusercontent.com/Eltomyalfonzo/RataLab/main/firmware_esp32_v1.1.ino" download class="download-btn-small">Descargar</a>
                            </div>
                            <div class="firmware-item">
                                <div class="firmware-info">
                                    <strong>Firmware v2.0 - Laberintos</strong>
                                    <span class="firmware-tag firmware-tag-new">Nuevo</span>
                                    <p>Algoritmos de resoluciÃ³n de laberintos integrados (A*, Dijkstra, BFS)</p>
                                </div>
                                <a href="https://raw.githubusercontent.com/Eltomyalfonzo/RataLab/main/firmware_esp32_v2.0.ino" download class="download-btn-small">Descargar</a>
                            </div>
                            <div class="firmware-item">
                                <div class="firmware-info">
                                    <strong>Firmware v3.0 - Tremouse</strong>
                                    <span class="firmware-tag firmware-tag-recommended">Recomendado</span>
                                    <p>Mapeo Tremouse con 3 sensores ultrasonido + publicaciÃ³n de paredes por MQTT</p>
                                </div>
                                <a href="https://raw.githubusercontent.com/Eltomyalfonzo/RataLab/main/firmware_tremouse.ino" download class="download-btn-small">Descargar</a>
                            </div>
                        </div>
                    </div>
                    
                    <div class="download-category">
                        <div class="category-header">
                            <div class="download-icon">ğŸ”§</div>
                            <div class="category-info">
                                <h4>Recursos Adicionales</h4>
                                <p>Bibliotecas, esquemÃ¡ticos y archivos de soporte</p>
                            </div>
                        </div>
                        <div class="github-link">
                            <svg width="24" height="24" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"/>
                            </svg>
                            <a href="https://github.com/Eltomyalfonzo/RataLab" target="_blank" rel="noopener noreferrer">github.com/Eltomyalfonzo/RataLab</a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• CONNECTION TAB -->
            <div id="connection-tab" class="tab-content">
                <h2>ConexiÃ³n MQTT</h2>
                
                <div class="info-box">
                    <h3>Estado de la ConexiÃ³n</h3>
                    <p>Introduce el nombre de tu robot y presiona "Conectar" para establecer la comunicaciÃ³n.</p>
                </div>
                
                <div class="input-group">
                    <input type="text" id="robotName" placeholder="Nombre del robot (ej: robot01)">
                    <button id="connectBtn">Conectar</button>
                </div>
                
                <div class="info-box">
                    <h3>ConfiguraciÃ³n del Broker</h3>
                    <p><strong>Broker:</strong> HiveMQ Cloud</p>
                    <p><strong>URL:</strong> f9d90e4c488c4716ac1e5862b9c8a708.s1.eu.hivemq.cloud</p>
                    <p><strong>Puerto:</strong> 8884 (WSS)</p>
                    <p><strong>Topic de comandos:</strong> [nombre_robot]/cmd</p>
                    <p><strong>Topic de datos:</strong> [nombre_robot]/data</p>
                </div>
                
                <div class="info-box">
                    <h3>Instrucciones</h3>
                    <p>1. AsegÃºrate de que tu robot ESP32 estÃ© encendido y conectado a WiFi</p>
                    <p>2. El robot debe estar programado con el mismo nombre que introduces arriba</p>
                    <p>3. Una vez conectado, podrÃ¡s enviar comandos y recibir datos del robot</p>
                    <p>4. El indicador de estado mostrarÃ¡ "Conectado" cuando la comunicaciÃ³n estÃ© establecida</p>
                </div>
            </div>

            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• CONTROL TAB -->
            <div id="control-tab" class="tab-content">
                <h2>Control Manual del Robot</h2>
                
                <div class="control-status-box">
                    <div id="controlStatus" class="control-disabled">âš ï¸ Conecta el robot primero</div>
                </div>

                <!-- â”€â”€ PANEL TREMOUSE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
                <div class="auto-panel auto-panel-tremouse">
                    <h3>ğŸ­ Modo Tremouse â€” Mapeo con 3 Ultrasonidos</h3>
                    <p>El robot explora el laberinto celda a celda usando la <strong>regla de mano izquierda</strong>. Los 3 sensores ultrasonido (izquierdo, frontal, derecho) detectan paredes y las envÃ­an en tiempo real al mapa.</p>

                    <!-- Estado Tremouse -->
                    <div id="tremouseStatus" class="path-status path-status-idle" style="margin-bottom:12px;">
                        En espera
                    </div>

                    <div class="auto-btn-row">
                        <button class="auto-btn auto-btn-tremouse" id="btnTremouse" disabled onclick="iniciarTremouse()">
                            <span class="auto-btn-icon">ğŸ­</span>
                            <span class="auto-btn-label">Iniciar Tremouse</span>
                            <span class="auto-btn-sub">EnvÃ­a TM al robot</span>
                        </button>
                        <button class="auto-btn auto-btn-stop-mv" onclick="MQTTClient.sendMessage('S')" disabled id="btnStopTremouse">
                            <span class="auto-btn-icon">â¹ï¸</span>
                            <span class="auto-btn-label">Detener</span>
                            <span class="auto-btn-sub">EnvÃ­a S</span>
                        </button>
                    </div>

                    <div class="tremouse-info-row">
                        <span class="tremouse-info-label">Protocolo MQTT:</span>
                        <code>CELL:col,row,wN,wE,wS,wW</code>
                    </div>
                    <div class="tremouse-info-row">
                        <span class="tremouse-info-label">OrientaciÃ³n inicial:</span>
                        <code>Norte (fija)</code>
                    </div>
                    <div class="tremouse-info-row">
                        <span class="tremouse-info-label">TamaÃ±o de celda:</span>
                        <code>25 Ã— 25 cm</code>
                    </div>
                </div>

                <!-- â”€â”€ MODO AUTÃ“NOMO CLÃSICO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
                <div class="auto-panel">
                    <h3>ğŸ¤– Modo AutÃ³nomo ClÃ¡sico</h3>
                    <p>EnvÃ­a la seÃ±al <code>MV</code> al robot para que inicie la navegaciÃ³n autÃ³noma con sus sensores (sin mapeo de paredes).</p>
                    <div class="auto-btn-row">
                        <button class="auto-btn auto-btn-mv" id="btnModoAutonomo" disabled>
                            <span class="auto-btn-icon">ğŸš€</span>
                            <span class="auto-btn-label">Iniciar Modo AutÃ³nomo</span>
                            <span class="auto-btn-sub">EnvÃ­a MV</span>
                        </button>
                        <button class="auto-btn auto-btn-stop-mv" onclick="MQTTClient.sendMessage('S')" disabled id="btnStopAutonomo">
                            <span class="auto-btn-icon">â¹ï¸</span>
                            <span class="auto-btn-label">Detener AutÃ³nomo</span>
                            <span class="auto-btn-sub">EnvÃ­a S</span>
                        </button>
                    </div>
                </div>

                <!-- â”€â”€ EJECUTAR RUTA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
                <div class="auto-panel auto-panel-route">
                    <h3>ğŸ—ºï¸ Ejecutar Ruta del Algoritmo</h3>
                    <p>Mueve el robot fÃ­sicamente siguiendo el camino Ã³ptimo calculado. <strong>Resuelve el laberinto primero</strong> desde la pestaÃ±a Trayectoria.</p>

                    <div id="pathStatus" class="path-status path-status-idle">
                        Listo para ejecutar
                    </div>

                    <div class="auto-btn-row">
                        <button class="auto-btn auto-btn-route" id="btnEjecutarRuta" disabled>
                            <span class="auto-btn-icon">â–¶ï¸</span>
                            <span class="auto-btn-label">Ejecutar Ruta</span>
                            <span class="auto-btn-sub">Sigue el camino Ã³ptimo</span>
                        </button>
                        <button class="auto-btn auto-btn-abort" id="btnAbortarRuta" disabled style="display:none;">
                            <span class="auto-btn-icon">â›”</span>
                            <span class="auto-btn-label">Abortar Ruta</span>
                            <span class="auto-btn-sub">Detiene inmediatamente</span>
                        </button>
                    </div>

                    <div class="route-info">
                        <span id="routeStepsInfo">Sin ruta cargada â€” ve a Trayectoria y resuelve el laberinto</span>
                    </div>

                    <!-- â”€â”€ CALIBRACIÃ“N DE PULSOS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
                    <div class="calibration-panel">
                        <div class="calibration-title">âš™ï¸ CalibraciÃ³n de movimiento</div>
                        <div class="calibration-row">
                            <div class="calibration-field">
                                <label for="inputPulsosCelda">Pulsos / celda (25 cm)</label>
                                <input type="number" id="inputPulsosCelda" value="46" min="10" max="200" step="1">
                            </div>
                            <div class="calibration-field">
                                <label for="inputPulsosGiro">Pulsos / giro 90Â°</label>
                                <input type="number" id="inputPulsosGiro" value="30" min="5" max="200" step="1">
                            </div>
                        </div>
                        <div class="calibration-btns">
                            <button class="calib-btn" id="btnTestGiro" disabled>ğŸ”„ Test Giro 90Â°</button>
                            <button class="calib-btn" id="btnTestAvance" disabled>â–¶ï¸ Test Avance 25cm</button>
                            <span class="calibration-hint">AjustÃ¡ los valores hasta que el movimiento sea exacto</span>
                        </div>
                    </div>
                </div>
                
                <!-- â”€â”€ CONTROL MANUAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
                <div class="control-panel">
                    <div class="control-row">
                        <div class="control-spacer"></div>
                        <button class="control-btn" id="btnForward" disabled>
                            <div class="arrow">â–²</div>
                            <div class="label">Adelante<br>(W)</div>
                        </button>
                        <div class="control-spacer"></div>
                    </div>
                    
                    <div class="control-row">
                        <button class="control-btn" id="btnLeft" disabled>
                            <div class="arrow">â—„</div>
                            <div class="label">Izquierda<br>(A)</div>
                        </button>
                        <button class="control-btn stop-btn" id="btnStop" disabled>
                            <div class="arrow">â– </div>
                            <div class="label">Detener<br>(S)</div>
                        </button>
                        <button class="control-btn" id="btnRight" disabled>
                            <div class="arrow">â–º</div>
                            <div class="label">Derecha<br>(D)</div>
                        </button>
                    </div>
                    
                    <div class="control-row">
                        <div class="control-spacer"></div>
                        <button class="control-btn" id="btnBackward" disabled>
                            <div class="arrow">â–¼</div>
                            <div class="label">AtrÃ¡s<br>(X)</div>
                        </button>
                        <div class="control-spacer"></div>
                    </div>
                </div>
                
                <div class="control-settings">
                    <label>
                        Velocidad del Robot:
                        <input type="range" id="speedSlider" min="50" max="255" value="150" disabled>
                        <span id="speedValue">150</span>
                    </label>
                </div>
                
                <div class="info-box">
                    <h3>Controles de Teclado</h3>
                    <p><strong>W</strong> - Adelante &nbsp; <strong>A</strong> - Izquierda &nbsp; <strong>S</strong> - Detener &nbsp; <strong>D</strong> - Derecha &nbsp; <strong>X</strong> - AtrÃ¡s</p>
                    <p class="note">Los controles de teclado solo funcionan cuando el robot estÃ¡ conectado.</p>
                </div>
            </div>

            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• MAZE TAB -->
            <div id="maze-tab" class="tab-content">
                <h2>VisualizaciÃ³n de Trayectoria y Paredes</h2>

                <!-- Indicador Tremouse activo -->
                <div id="mazeMapNotice" class="tremouse-map-notice" style="display:none;">
                    ğŸ­ <strong>Tremouse activo</strong> â€” recibiendo paredes en tiempo real
                </div>
                
                <div class="maze-controls">
                    <button onclick="Maze.clear()">ğŸ—‘ï¸ Limpiar Canvas</button>
                    <input type="file" id="mazeFile" accept=".txt,.csv" style="display: none;">
                    <button onclick="document.getElementById('mazeFile').click()">ğŸ“‚ Cargar Archivo</button>
                    <button onclick="exportMazeData()">ğŸ’¾ Exportar Datos</button>
                    <button id="toggleWallsBtn" onclick="toggleWalls()" class="btn-walls-active">ğŸ§± Ocultar Paredes</button>
                </div>
                
                <div class="solver-controls">
                    <h3>ğŸ¤– ResoluciÃ³n AutomÃ¡tica</h3>
                    <div class="solver-group">
                        <label>Algoritmo:</label>
                        <select id="algorithmSelect">
                            <option value="astar">A* (HeurÃ­stico)</option>
                            <option value="dijkstra">Dijkstra (Ã“ptimo)</option>
                            <option value="bfs">BFS (Amplitud)</option>
                        </select>
                        <button onclick="solveMaze()">â–¶ï¸ Resolver Laberinto</button>
                        <button id="toggleSolutionBtn" onclick="toggleSolution()" style="display: none;">Ocultar SoluciÃ³n</button>
                    </div>
                </div>
                
                <div class="maze-settings">
                    <label>
                        Escala (px/cm): 
                        <input type="number" id="scale" value="4" min="1" max="20" step="1"
                               onchange="Maze.setScale(parseFloat(this.value))">
                        <span style="font-size:0.8em;color:#64748b;">(celda = valor Ã— 25 px)</span>
                    </label>
                </div>
                
                <div class="canvas-container">
                    <canvas id="mazeCanvas"></canvas>
                </div>
                
                <div class="info-box">
                    <h3>Leyenda del mapa:</h3>
                    <p><span class="legend-color" style="background: #22c55e;"></span> <strong>Verde (S):</strong> Celda de inicio</p>
                    <p><span class="legend-color" style="background: #ef4444;"></span> <strong>Rojo (E):</strong> Ãšltima celda visitada / fin</p>
                    <p><span class="legend-color" style="background: rgba(96,165,250,0.5);"></span> <strong>Azul claro:</strong> Celdas recorridas por el robot</p>
                    <p><span class="legend-color" style="background: #3b82f6;"></span> <strong>LÃ­nea azul:</strong> Trayectoria (centro a centro de celdas)</p>
                    <p><span class="legend-color" style="background: #f97316;"></span> <strong>Naranja:</strong> Paredes detectadas por los sensores Tremouse</p>
                    <p><span class="legend-color" style="background: rgba(245,158,11,0.5);"></span> <strong>Amarillo:</strong> Camino Ã³ptimo calculado por el algoritmo</p>
                    <p><span class="legend-color" style="background: #ef4444; border-radius:50%;"></span> <strong>CÃ­rculo rojo:</strong> PosiciÃ³n actual del robot con flecha de orientaciÃ³n</p>

                    <h3 style="margin-top:16px;">Protocolo Tremouse (MQTT):</h3>
                    <pre style="background:#f1f5f9;padding:10px;border-radius:4px;color:#1e293b;border:1px solid #e2e8f0;font-size:0.8em;">
Mensaje recibido:  CELL:col,row,wN,wE,wS,wW
Ejemplo:           CELL:2,3,1,0,0,1
                   â†’ celda (2,3), pared N, libre E, libre S, pared W

Comando inicio:    TM   â†’ inicia Tremouse
Comando stop:      S    â†’ detiene el robot
OrientaciÃ³n:       Norte fija (heading 0 en todo momento al arrancar)</pre>
                </div>
            </div>

            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• CONSOLE TAB -->
            <div id="console-tab" class="tab-content">
                <h2>Puerto Serial Virtual</h2>
                <div id="console" class="console"></div>
                <div class="input-group" style="margin-top: 15px;">
                    <input type="text" id="messageInput" placeholder="Escribe un mensaje..." disabled>
                    <button id="sendBtn" disabled>Enviar</button>
                </div>
                <button class="clear-btn">Limpiar Consola</button>
            </div>

        </main>
    </div>

    <script src="config.js"></script>
    <script src="console.js"></script>
    <script src="maze.js"></script>
    <script src="solver.js"></script>
    <script src="control.js"></script>
    <script src="ui.js"></script>
    <script src="mqtt.js"></script>
    <script>
        // â”€â”€ MenÃº hamburguesa â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        window.addEventListener('load', () => {
            const hamburgerBtn = document.getElementById('hamburgerBtn');
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.querySelector('.main-content');
            
            if (hamburgerBtn && sidebar && mainContent) {
                hamburgerBtn.addEventListener('click', (e) => {
                    e.preventDefault(); e.stopPropagation();
                    sidebar.classList.toggle('sidebar-hidden');
                    mainContent.classList.toggle('sidebar-hidden');
                    hamburgerBtn.classList.toggle('active');
                });
                document.querySelectorAll('.tab').forEach(tab => {
                    tab.addEventListener('click', () => {
                        if (window.innerWidth <= 768) {
                            sidebar.classList.add('sidebar-hidden');
                            mainContent.classList.add('sidebar-hidden');
                            hamburgerBtn.classList.remove('active');
                        }
                    });
                });
            }
        });
        
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('mazeFile').addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) Maze.loadFromFile(file);
            });
        });

        // â”€â”€ Tremouse â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function iniciarTremouse() {
            if (!AppState.isConnected) {
                Console.logError('âš ï¸ Conecta el robot primero');
                return;
            }
            MQTTClient.sendMessage('TM');
            Console.logSystem('ğŸ­ Tremouse iniciado (TM enviado)');
            document.getElementById('tremouseStatus').textContent = 'ğŸ­ Tremouse en ejecuciÃ³n...';
            document.getElementById('tremouseStatus').className = 'path-status path-status-running';
            // Cambiar a pestaÃ±a del mapa
            UI.switchTab('maze');
        }

        // â”€â”€ Toggle paredes â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function toggleWalls() {
            const visible = Maze.toggleWalls();
            const btn = document.getElementById('toggleWallsBtn');
            btn.textContent = visible ? 'ğŸ§± Ocultar Paredes' : 'ğŸ§± Mostrar Paredes';
            btn.className   = visible ? 'btn-walls-active' : '';
        }

        // â”€â”€ Firmware list â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function toggleFirmwareList() {
            const list  = document.getElementById('firmwareList');
            const arrow = document.getElementById('firmwareArrow');
            if (list.style.display === 'none') { list.style.display = 'block'; arrow.textContent = 'â–²'; }
            else                                { list.style.display = 'none';  arrow.textContent = 'â–¼'; }
        }

        // â”€â”€ Exportar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function exportMazeData() {
            const data = Maze.exportData();
            if (!data) { Console.logError('No hay datos para exportar'); return; }
            const blob = new Blob([data], { type: 'text/plain' });
            const url  = URL.createObjectURL(blob);
            const a    = document.createElement('a');
            a.href = url; a.download = `mapa_tremouse_${new Date().getTime()}.txt`; a.click();
            URL.revokeObjectURL(url);
            Console.logSystem('Mapa exportado exitosamente');
        }

        // â”€â”€ Resolver laberinto â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function solveMaze() {
            const algorithm = document.getElementById('algorithmSelect').value;
            const solution  = MazeSolver.solve(algorithm);
            if (solution) {
                Maze.setSolution(solution);
                document.getElementById('toggleSolutionBtn').style.display = 'inline-block';
                Console.logSystem(`âœ“ Laberinto resuelto con ${algorithm.toUpperCase()} â€” ${solution.length - 1} pasos`);
                RobotControl.actualizarInfoRuta();
            }
        }

        function toggleSolution() {
            Maze.toggleSolution();
            document.getElementById('toggleSolutionBtn').textContent =
                Maze.showSolution ? 'Ocultar SoluciÃ³n' : 'Mostrar SoluciÃ³n';
        }
    </script>
</body>
</html>
